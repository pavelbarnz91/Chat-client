(()=>{"use strict";class e{constructor(e){this.user=e,this.usersOnline=[this.user],this.wrapper=document.querySelector(".wrapper"),this.usersOnlineList=this.wrapper.querySelector(".chat__users-online"),this.enterMessageWindow=this.wrapper.querySelector(".input-box__input"),this.btnBox=this.wrapper.querySelector(".enter-message-box__btn-box"),this.exitBtn=this.wrapper.querySelector(".chat__exit-btn"),this.startChat()}startChat(){const e=new WebSocket("WSS://chatserver0.herokuapp.com");this.exitBtn.addEventListener("click",(()=>{e.send(JSON.stringify({del:this.user})),document.querySelector(".chat").remove(),document.querySelector(".youname__wrapper").classList.remove("hidden"),e.close()})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);if(void 0!==t.text){const e=this.pickOutMySms(t);return document.querySelector(".chat__messages-window").insertAdjacentHTML("beforeend",e),this.scrollDownChat(),void(this.enterMessageWindow.value="")}const s=document.createElement("div");s.classList.add("chat__users-online"),t.users.forEach((e=>{let t;t=e.userName===this.user.userName?`<span class="onlineUser me">${e.userName}</span>`:`<span class="onlineUser">${e.userName}</span>`,s.insertAdjacentHTML("beforeend",t)}));const a=document.querySelector(".chat__users-online");document.querySelector(".chat__users").replaceChild(s,a);const n=document.createElement("div");n.classList.add("chat__messages-window"),t.actualDialog.forEach((e=>{const t=this.pickOutMySms(e);n.insertAdjacentHTML("beforeend",t)})),this.messagesWindow=document.querySelector(".chat__messages-window"),document.querySelector(".chat__window").replaceChild(n,this.messagesWindow),this.scrollDownChat()})),this.btnBox.addEventListener("click",(t=>{if("clear"===t.target.dataset.messagebtn)this.enterMessageWindow.value="",this.enterMessageWindow.focus();else if("send"===t.target.dataset.messagebtn){const t={userName:this.user.userName,date:this.setDate(),text:this.enterMessageWindow.value};e.send(JSON.stringify(t))}}))}setDate(){const e=new Date;return`${e.getHours()<10?`0${e.getHours()}`:e.getHours()}:${e.getMinutes()<10?`0${e.getMinutes()}`:e.getMinutes()} ${e.getDate()<10?`0${e.getDate()}`:e.getDate()}.${(e.getMonth()<10?`0${e.getMonth()}`:e.getMonth())+1}.${e.getFullYear()}`}scrollDownChat(){const e=document.querySelector(".chat__messages-window");e.scrollTo({top:e.scrollHeight})}pickOutMySms(e){return e.userName===this.user.userName?`<div class="my-sms">\n                        <div class="sms__header-me">\n                            <span class="autor">${e.userName}</span>\n                            <span class="date">${e.date}</span>\n                        </div>\n                        <span>${e.text}</span>\n                    </div>`:`<div class="sms">\n                        <div class="sms__header">\n                            <span class="autor">${e.userName}</span>\n                            <span class="date">${e.date}</span>\n                        </div>\n                        <span>${e.text}</span>\n                    </div>`}}class t{constructor(e){this.app=e,this.sayMyNameBtn=this.app.querySelector(".youname__btn"),this.name=this.app.querySelector(".youname__input"),this.user=null,this.myNameIs()}myNameIs(){this.app.querySelector(".youname__wrapper")&&document.querySelector(".youname__btn").addEventListener("click",(()=>{if(this.name.value<1)return void this.showError("Имя не должно быть менее одного символа");const t=new FormData;t.set("userName",this.name.value),function(e,t,s){const a="https://chatserver0.herokuapp.com";return"GET"===t?fetch(`${a}?${s}`):"GET"!==t?fetch(a+e,{method:t,body:s}):void 0}("/checkUser","POST",t).then((async t=>{const s=await t.json();s.status?this.showError(s.text):(this.name.value="",this.app.querySelector(".youname__wrapper").classList.add("hidden"),this.user=s.name,this.app.insertAdjacentHTML("beforeend",s.html),new e(this.user))}))}))}showError(e){const t=document.querySelector(".youname__error");t.classList.remove("hidden"),t.textContent=e,setInterval((()=>{t.classList.add("hidden")}),2e3)}}new class{constructor(){this.appWindow=document.querySelector(".wrapper"),this.start()}start(){new t(this.appWindow)}}})();